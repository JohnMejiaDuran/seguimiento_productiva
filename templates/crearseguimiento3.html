{% extends "layout.html" %}
{% block consultar%}
<button type="button" class="btn btn-outline-success ">
    <a  class="nav-link active text-white" href="/inicioinstructor"><i class="fa-solid fa-house"></i></a>
</button>
<button type="button" class="btn btn-outline-success ">
    
    <a  class="nav-link active text-white" href="/crearseguimiento3">Crear seguimiento</a>
</button>
<button type="button" class="btn btn-outline-success ">
  <a  class="nav-link active text-white" href="/aprendicesasignados">Aprendices Asignados</a>
</button>
{% endblock%}
{% block content %}
<style>
    .form-control {
        height: 2.5rem;
    }
</style>
<form class="container-fluid w-75">
    <h5 class="">DATOS DEL APRENDIZ</h5>
    <div class="form-row d-flex">
        <div class="form-group col-md-6 p-2" style="position: relative;">
            <label for="documento"><b>Identificación:</b></label>
            <input type="text" class="form-control" id="documento" placeholder="Número de documento" autocomplete="off">
            <div id="datalist" style="position: absolute; overflow-y: auto; max-height: 20rem; overflow-x: hidden;"></div>
<!-- Lista desplegable -->
        </div>
        <div class="form-group col-md-6 p-2 ">
            <label for="nombreAprendiz"><b>Nombre:</b></label>
            <div class="form-control" id="aprendiz">
                
            </div>
        
        </div>
    </div>

    <div class="form-row d-flex">
        <div class="form-group col-md-6 p-2">
            <label for="regional" class="font-weight-bold"><b>Regional:</b></label>
            <div class="form-control" id="regional"></div>
        </div>
        <div class="form-group col-md-6 p-2">
            <label for="centro"><b>Centro de Formación:</b></label>
            <div class="form-control" id="centro"></div>
        </div>
    </div>

    <div class="form-row d-flex">
        <div class="form-group col-md-6 p-2">
            <label for="ficha"><b>No. de ficha:</b></label>
            <div class="form-control" id="ficha"></div>
        </div>
        <div class="form-group col-md-6 p-2">
            <label for="programa"><b>Programa de Formación:</b></label>
            <div class="form-control" id="programa"></div>
        </div>
    </div>
</form>
<script>
    $(document).ready(function(){
        $("#documento").on("input", function(e){
            var inputValue = $(this).val().trim();
            if (inputValue === "") {
                // Si el campo está vacío, limpiar los otros campos
                $("#aprendiz, #regional, #centro, #ficha, #programa").text("");
                $("#datalist").empty();
                return;
            }
            $("#datalist").empty();
            $.ajax({
                type: "get",
                url: "/buscar_aprendiz",
                data: { text: inputValue },
                success: function(res){
                    var data = "<div class='list-group'>";
                    $.each(res, function(index, value){
                        data += "<p style='margin: 0; width: 30rem;' class='list-group-item list-group-item-action' data-documento='" + value.documento + "'>" + value.documento + "</p>";
                    });
                    data += "</div>";
                    $("#datalist").html(data);
                }
            });
        });

        // Cerrar el datalist al hacer clic fuera de él
        $(document).click(function(e) {
            if (!$(e.target).closest('#datalist, #documento').length) {
                $("#datalist").empty();
            }
        });

        // Manejar la selección de un elemento de la lista
        $(document).on("click", "#datalist .list-group-item", function(){
            var documentoSeleccionado = $(this).data("documento");
            $("#documento").val(documentoSeleccionado);
            $("#datalist").empty();

            // Realizar una solicitud AJAX adicional para obtener la información del aprendiz
            $.ajax({
                type: "get",
                url: "/get_aprendiz/" + documentoSeleccionado,
                success: function(aprendiz){
                    $("#aprendiz").text(aprendiz.nombre_aprendiz + " " +  aprendiz.apellido_aprendiz);
                    $("#regional").text(aprendiz.nombre_regional);
                    $("#centro").text(aprendiz.nombre_centro);
                    $("#ficha").text(aprendiz.codigo_ficha);
                    $("#programa").text(aprendiz.programa);
                }
            });
        });
    });
</script>

    
    
    <script>
        $(document).ready(function(){
            $('#regional').change(function(){
                var regionalId = $(this).val();
                $.ajax({
                    url: '/get_centros/' + regionalId,
                    type: 'GET',
                    success: function(response){
                        var centros = response.centros;
                        var options = '<option value="">Seleccionar Centro de Formación</option>';
                        for(var i=0; i<centros.length; i++){
                            options += '<option value="' + centros[i].codigo_centro + '">' + centros[i].nombre_centro + '</option>';
                        }
                        $('#centro').html(options);
                    },
                    error: function(error){
                        console.log(error);
                    }
                });
            });
        });
    </script>
   
{% endblock %}